---
layout: post
title: "Поддержка Java 7 try-with-resources в MyBatis"
date: 2012-01-13 10:41
comments: true
categories: [ibatis, java, java7]
---
В Java 7 появился аналог конструкции using из C# - [try-with-resources](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html). Данную фишку очень хорошо использовать для автоматического закрытия ресурсов типа коннектов к базам данных и тд. Например так:
{% gist 1638790 %}

Но вот беда - класс org.apache.ibatis.session.SqlSession из MyBatis 3.0.6 использующегося в проекте не реализует интерфейс AutoCloseable необходимый для того что бы эта конструкция заработала. Надеюсь что в следующей версии поддержку добавят, а пока предлагаю небольшой workaround.
<!--more-->

В первую очередь реализуем обертку для класса SqlSession реализующую интерфейс AutoCloseable:
{% gist 1638811 %}

Также нам понадобится обертка для SqlSessionFactory умеющая работать с нашим классом SqlSession.
{% gist 1638826 %}

Ну а теперь - магия: конфигурируем iBatis как обычно. Ну почти как обычно, за исключением строки 18, где мы инициализируем нашу обертку.
{% gist 1638837 %}

Это все, теперь мы можем радоваться фишками java7 в проекте :)

