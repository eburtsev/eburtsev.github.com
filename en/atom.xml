<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Eugene Burtsev's blog]]></title>
  <link href="http://burtsev.net/en/atom.xml" rel="self"/>
  <link href="http://burtsev.net/en"/>
  <updated>2013-03-28T00:04:14+04:00</updated>
  <id>http://burtsev.net/en</id>
  <author>
    <name><![CDATA[Eugene Burtsev]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  
  
  
  <entry>
    <title type="html"><![CDATA[Merging unrelated repositories in mercurial]]></title>
    <link href="http://burtsev.net/en/2013/03/27/merging-unrelated-repositories-in-mercurial/"/>
    <updated>2013-03-27T21:46:00+04:00</updated>
    <id>http://burtsev.net/en/2013/03/27/merging-unrelated-repositories-in-mercurial</id>
    <content type="html"><![CDATA[<p>Some time ago I had some projects which I wanted to combine in one big project and keep history for all of them. This can be done following to <a href="http://mercurial.selenic.com/wiki/MergingUnrelatedRepositories">this article</a>. But if I&#8217;ll use this solution in result I&#8217;ll have more than one tails (how it illustrated in picture below).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   @
</span><span class='line'>   |
</span><span class='line'>   o-----------o
</span><span class='line'>   |           |
</span><span class='line'>   .           .
</span><span class='line'>   .           .
</span><span class='line'>   |           |
</span><span class='line'>   o           o
</span><span class='line'>  tail        tail
</span><span class='line'>   #1          #2</span></code></pre></td></tr></table></div></figure>


<p>But I wanted to make repository structure as on picture below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   @
</span><span class='line'>   |
</span><span class='line'>   o-----------o
</span><span class='line'>   |           |
</span><span class='line'>   . default   .
</span><span class='line'>   .           . Feature
</span><span class='line'>   |           | branch
</span><span class='line'>   o           o
</span><span class='line'>   |           |
</span><span class='line'>   o-----------o
</span><span class='line'>   |
</span><span class='line'>   o</span></code></pre></td></tr></table></div></figure>


<p>After some hours with console magic I found solution, and I want to share it.</p>

<!--more-->


<p>I decided to modify history to avoid possible merge conflicts. I moved all files in each project to appropriate subfolder (named as project). To do this we needs to export patch and modify it to change pathes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">PROJECT</span><span class="o">=</span>project1
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>
</span><span class='line'>hg <span class="nb">export</span> -r0:tip -o <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>
</span><span class='line'><span class="c"># Modify patch (Move all files to subdirectory)</span>
</span><span class='line'>
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/\(diff -r [0-9a-f]* -r [0-9a-f]*\) \(.*\)/\1 ${PROJECT}\/\2/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/--- a/\0\/${PROJECT}/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/+++ b/\0\/${PROJECT}/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span></code></pre></td></tr></table></div></figure>


<p>For each of projects we need to make some steps (enough to change <code>PROJECT</code> variable)</p>

<p>If you want move projects to named branches instead of multiply default branches you needs prepare following commands which adds branch name information to patch:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">BRANCH</span><span class="o">=</span><span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span> branch
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/# Date \(.*\)/# Date \1\n# Branch $BRANCH/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span></code></pre></td></tr></table></div></figure>


<p>Now we have patches made from all projects we can combine them. First initialize aggregate repository and import oldest project of all.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>hg init combined
</span><span class='line'>hg import ../project1/project1.patch
</span></code></pre></td></tr></table></div></figure>


<p>For other project we need do following steps:</p>

<ol>
<li>Update aggregate project to revision which will be parent for appropriate project</li>
<li>Import patch (don&#8217;t forget <code>--import-branch</code> key if you using named branches)</li>
<li>Merge branches</li>
<li>Repeat it for other patches</li>
</ol>


<p>This approach illustrated below. If you not using named branches you can use these simple steps:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>hg up &lt;parent-revision&gt;
</span><span class='line'>hg import ../project1/project1.patch --import-branch
</span><span class='line'>hg merge
</span></code></pre></td></tr></table></div></figure>


<p>If you using named branches your way will more complicated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>hg up &lt;parent-revision&gt;
</span><span class='line'>hg import ../project1/project1.patch --import-branch
</span><span class='line'>hg up &lt;latest-patch-revision&gt; <span class="c"># update to latest revision of imported project</span>
</span><span class='line'>hg commit --close-branch
</span><span class='line'>hg up default
</span><span class='line'>hg merge &lt;latest-patch-revision&gt;
</span><span class='line'>hg commit -m <span class="s2">&quot;Merge&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ve created script which can help to automate first part of this article:</p>

<figure class='code'><figcaption><span>modify-patch.sh </span><a href='http://burtsev.net/downloads/merging-unrelated-repositories-in-mercurial/modify-patch.sh'>Download</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">PROJECT</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>
</span><span class='line'><span class="nb">pushd</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'>hg <span class="nb">export</span> -r0:tip -o <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>
</span><span class='line'><span class="c"># Modify patch (Move all files to subdirectory)</span>
</span><span class='line'>
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/\(diff -r [0-9a-f]* -r [0-9a-f]*\) \(.*\)/\1 ${PROJECT}\/\2/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/--- a/\0\/${PROJECT}/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>sed -i.bak -e <span class="s2">&quot;s/+++ b/\0\/${PROJECT}/g&quot;</span> <span class="k">${</span><span class="nv">PROJECT</span><span class="k">}</span>.patch
</span><span class='line'>
</span><span class='line'><span class="nb">popd</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ll glad if this article will useful for someone. Comments are welcome.</p>
]]></content>
  </entry>
  
  
  
  
  
  <entry>
    <title type="html"><![CDATA[Maven custom repository layout]]></title>
    <link href="http://burtsev.net/en/2012/11/10/maven-custom-repository-layout/"/>
    <updated>2012-11-10T08:42:00+04:00</updated>
    <id>http://burtsev.net/en/2012/11/10/maven-custom-repository-layout</id>
    <content type="html"><![CDATA[<p>I&#8217;ve developed maven plugin to access repositories with custom structure. And I would share this solution with community.</p>

<p>Some time ago, I worked on java web project, and I used some JavaScript dependencies for it.
I&#8217;ve throught about dependency management for javascript dependencies like JQuery. Ordinary JS dependencies is not management, so we need download new versions manually.
First I found <a href="http://twitter.github.com/bower/">Bower</a> for javascript dependency management, but I afraid of node.js in dependencies for my project. I thought about CDNs which hosts js libraries. (for example jquery on Google CDN: <a href="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js</a>).
I using maven in my projec, so it will be good to use CDNs via maven&#8230; Because CDN&#8217;s directories stricture is differs from standart maven layout, I decided to write own maven plugin to handle custom repository layout.</p>

<!-- more -->


<p>When I looked for solution I found that maven allows write plugins which handles custom repository types. But I found too less examples how to do it. I found only one thing: for create custom repository handler we needs to implement RepositoryConnectorFactory interface. I&#8217;ve created simple calss to test this approach:</p>

<figure class='code'><figcaption><span>CustomRepositoryConnectorFactory.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Component</span><span class="o">(</span><span class="n">role</span> <span class="o">=</span> <span class="n">RepositoryConnectorFactory</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;custom&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomRepositoryConnectorFactory</span> <span class="kd">implements</span> <span class="n">RepositoryConnectorFactory</span><span class="o">,</span> <span class="n">Service</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="n">RepositoryConnector</span> <span class="nf">newInstance</span><span class="o">(</span><span class="n">RepositorySystemSession</span> <span class="n">session</span><span class="o">,</span>
</span><span class='line'>                <span class="n">RemoteRepository</span> <span class="n">repository</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoRepositoryConnectorException</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;CustomRepositoryConnectorFactory.newInstance()&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPriority</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initService</span><span class="o">(</span><span class="n">ServiceLocator</span> <span class="n">locator</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But this has not worked. To make it work we also need to generate maven component description in META-INF/plexus/components.xml file. To create this file there is plexus-component-metadata plugin, which parses annotations and creates this magic file.</p>

<figure class='code'><figcaption><span>components.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>    <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>org.codehaus.plexus<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>plexus-component-metadata<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>1.5.5<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;goal&gt;</span>generate-metadata<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After components.xml generated and I installed plugin in my local repository all worked fine.</p>

<p>How to use it. First, add my maven repo in your pom.xml (for a while I host it in my own repo, but in future I want to move it to Maven Central):</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;pluginRepositories&gt;</span>
</span><span class='line'>  <span class="nt">&lt;pluginRepository&gt;</span>
</span><span class='line'>      <span class="nt">&lt;id&gt;</span>maven-burtsev-net<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url&gt;</span>http://maven.burtsev.net<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/pluginRepository&gt;</span>
</span><span class='line'><span class="nt">&lt;/pluginRepositories&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Enable plugin in build section of pom.xml:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;build&gt;</span>
</span><span class='line'>  <span class="nt">&lt;extensions&gt;</span>
</span><span class='line'>      <span class="nt">&lt;extension&gt;</span>
</span><span class='line'>          <span class="nt">&lt;groupId&gt;</span>net.burtsev.maven<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>          <span class="nt">&lt;artifactId&gt;</span>maven-custom-repository-layout<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>          <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/extension&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/extensions&gt;</span>
</span><span class='line'><span class="nt">&lt;/build&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add some repositories, for example:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;repository&gt;</span>
</span><span class='line'>  <span class="nt">&lt;id&gt;</span>google-cdn<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>  <span class="nt">&lt;url&gt;</span>http://ajax.googleapis.com/ajax/libs/$groupId/$version/$artifactId${classifier(prefix:.)}.$extension<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>  <span class="nt">&lt;layout&gt;</span>custom<span class="nt">&lt;/layout&gt;</span>
</span><span class='line'><span class="nt">&lt;/repository&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In repository URL we can use following wildcards which will replaced with appropriate values for each artifact:</p>

<ul>
<li>$groupId</li>
<li>$artifactId</li>
<li>$version</li>
<li>$classifier</li>
<li>$extension</li>
</ul>


<p>For parameter which can be empty there is alternate syntax: <code>${classifier(prefix:.)}</code>. this syntax is useful for eliminate separators duplicates if value will empty.</p>

<p>After we configured repository we can add some dependencies, for example:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependencies&gt;</span>
</span><span class='line'>  <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>      <span class="nt">&lt;groupId&gt;</span>jquery<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;artifactId&gt;</span>jquery<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;version&gt;</span>1.8.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>      <span class="nt">&lt;classifier&gt;</span>min<span class="nt">&lt;/classifier&gt;</span>
</span><span class='line'>      <span class="nt">&lt;type&gt;</span>js<span class="nt">&lt;/type&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ve used maven-dependency-plugin to copy downloaded libraries to webapp folder:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>  <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>      <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>          <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>              <span class="nt">&lt;id&gt;</span>copy-dependencies<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>              <span class="nt">&lt;phase&gt;</span>generate-resources<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>              <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;goal&gt;</span>copy-dependencies<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>              <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;outputDirectory&gt;</span>${project.build.directory}/${project.build.finalName}/js<span class="nt">&lt;/outputDirectory&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;includeArtifactIds&gt;</span>jquery<span class="nt">&lt;/includeArtifactIds&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;includeTypes&gt;</span>js<span class="nt">&lt;/includeTypes&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'><span class="nt">&lt;/plugins&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That is it. Now we can manage JS dependencies with maven.</p>

<p>Sources can be found here: <a href="https://bitbucket.org/eburtsev/maven-custom-repository-layout">https://bitbucket.org/eburtsev/maven-custom-repository-layout</a>
Plugin can be downloaded from my maven repository: <a href="http://maven.burtsev.net/">http://maven.burtsev.net/</a>
Sample project uses this plugin <a href="https://bitbucket.org/eburtsev/test-javascript-dependencies">https://bitbucket.org/eburtsev/test-javascript-dependencies</a></p>
]]></content>
  </entry>
  
  
  
  
  
  <entry>
    <title type="html"><![CDATA[JSF2 + Spring Framework Example]]></title>
    <link href="http://burtsev.net/en/2012/05/30/192/"/>
    <updated>2012-05-30T21:19:00+04:00</updated>
    <id>http://burtsev.net/en/2012/05/30/192</id>
    <content type="html"><![CDATA[<p>Just recently I&#8217;ve discovered the Spring Framework. IMHO it is amazing framework. And I decided to rewrite a couple of my applications using Spring. Below I tell how to integrate Spring and JSF2</p>

<!--more-->


<h2>Dependencies</h2>

<p>The first step is to add the org.springframework:spring-web artifact as project dependency:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>  <span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>  <span class="nt">&lt;version&gt;</span>3.1.1.RELEASE<span class="nt">&lt;/version&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setup</h2>

<p>To make it work you must configure listeners in web.xml, as shown in the following example:</p>

<figure class='code'><figcaption><span>web.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
</span><span class='line'>      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>      <span class="na">xmlns:web=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span>
</span><span class='line'>      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span>
</span><span class='line'>      <span class="na">id=</span><span class="s">&quot;jsf2-spring-example&quot;</span> <span class="na">version=</span><span class="s">&quot;2.5&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;display-name&gt;</span>jsf2-spring-example Application<span class="nt">&lt;/display-name&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;listener&gt;</span>
</span><span class='line'>      <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/listener&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;listener&gt;</span>
</span><span class='line'>      <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.request.RequestContextListener<span class="nt">&lt;/listener-class&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/listener&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;context-param&gt;</span>
</span><span class='line'>      <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;param-value&gt;</span>classpath:spring-context.xml<span class="nt">&lt;/param-value&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/context-param&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>Faces Servlet<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-class&gt;</span>javax.faces.webapp.FacesServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span><span class='line'>      <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet-mapping&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>Faces Servlet<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url-pattern&gt;</span>*.jsf<span class="nt">&lt;/url-pattern&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet-mapping&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet-mapping&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>Faces Servlet<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url-pattern&gt;</span>/faces/*<span class="nt">&lt;/url-pattern&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet-mapping&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/web-app&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is also necessary to set custom el-resolver from Spring instead of the standard to allow Spring manage beans. Change faces-config.xml as in following piece of code:</p>

<figure class='code'><figcaption><span>faces-config.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;faces-config</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> <span class="na">xmlns:xi=</span><span class="s">&quot;http://www.w3.org/2001/XInclude&quot;</span>
</span><span class='line'>    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-facesconfig_2_0.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;application&gt;</span>
</span><span class='line'>      <span class="nt">&lt;el-resolver&gt;</span>org.springframework.web.jsf.el.SpringBeanFacesELResolver<span class="nt">&lt;/el-resolver&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/application&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/faces-config&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now configure spring-context.xml. You just need  to set base-package property for context:component-scan:</p>

<figure class='code'><figcaption><span>spring-context.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>  <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
</span><span class='line'>  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
</span><span class='line'><span class="s">    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- enable component scanning --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;net.burtsev.example&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- enable autowire --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;context:annotation-config</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Code</h2>

<p>Now, after we make all necessary settings, we can write some code:</p>

<h3>index.xhtml</h3>

<figure class='code'><figcaption><span>index.xhtml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;ui:composition</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
</span><span class='line'>  <span class="na">xmlns:h=</span><span class="s">&quot;http://java.sun.com/jsf/html&quot;</span>
</span><span class='line'>  <span class="na">xmlns:f=</span><span class="s">&quot;http://java.sun.com/jsf/core&quot;</span>
</span><span class='line'>  <span class="na">xmlns:ui=</span><span class="s">&quot;http://java.sun.com/jsf/facelets&quot;</span> <span class="na">template=</span><span class="s">&quot;/templates/main.xhtml&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;ui:define</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/ui:define&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;ui:define</span> <span class="na">name=</span><span class="s">&quot;body&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h:form</span> <span class="na">prependId=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;h:inputText</span> <span class="na">value=</span><span class="s">&quot;#{testBean.name}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;h:commandButton</span> <span class="na">action=</span><span class="s">&quot;#{testBean.sayHelloAction}&quot;</span> <span class="na">value=</span><span class="s">&quot;Say Hello&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;br/&gt;</span>
</span><span class='line'>          #{testBean.hello}
</span><span class='line'>      <span class="nt">&lt;/h:form&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ui:define&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/ui:composition&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>TestBean.java</h3>

<p>here we using @Controller annotation instead of JSF @ManagedBean and @Scope to set bean scope. List of all possible scopes you can see here: <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/beans.html#beans-factory-scopes">Spring Framework Reference</a>. Also in spring I not found view scope. But I found solution <a href="http://comdynamics.net/blog/109/spring3-jsf2-view-scope/">here</a> and <a href="http://cagataycivici.wordpress.com/2010/02/17/port-jsf-2-0s-viewscope-to-spring-3-0/">here</a></p>

<figure class='code'><figcaption><span>TestBean.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">burtsev</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">web</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Scope</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Controller</span>
</span><span class='line'><span class="nd">@Scope</span><span class="o">(</span><span class="s">&quot;session&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestBean</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sayHelloAction</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">hello</span> <span class="o">=</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">?</span> <span class="s">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHello</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">hello</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHello</span><span class="o">(</span><span class="n">String</span> <span class="n">hello</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">hello</span> <span class="o">=</span> <span class="n">hello</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Run example</h2>

<p>Run it and follow this link: <a href="http://localhost:8080/jsf2-spring-example/index.jsf">http://localhost:8080/jsf2-spring-example/index.jsf</a> It&#8217;s works! :)</p>

<p><a href="http://burtsev.net/downloads/192/test1.png"><img src="http://burtsev.net/downloads/192/test1.png" width="500" height="180" title="'Example #1'" ></a>
<a href="http://burtsev.net/downloads/192/test2.png"><img src="http://burtsev.net/downloads/192/test2.png" width="500" height="180" title="'Example #2'" ></a></p>

<p>P.S. Full project you can be downloaded from <a href="https://github.com/eburtsev/jsf2-spring-example">my github repository</a></p>
]]></content>
  </entry>
  
  
  
  
  
  <entry>
    <title type="html"><![CDATA[Google gdata maven repository]]></title>
    <link href="http://burtsev.net/en/2012/01/29/149/"/>
    <updated>2012-01-29T20:24:00+04:00</updated>
    <id>http://burtsev.net/en/2012/01/29/149</id>
    <content type="html"><![CDATA[<p>Some time ago, I was searching for <a href="http://code.google.com/p/gdata-java-client/">google gdata</a> maven repository, but I was surprised - it has no any maven repositories! Of course, there are a new <a href="http://code.google.com/p/google-api-java-client/">google-api-java-client</a>, , but it do not implements all google API&#8217;s, for example it don&#8217;t implement Provisioning API for domains.</p>

<p>I found some repositories with older versions of library.</p>

<p>Also I found awesome <a href="https://github.com/dcarter/Google-Data-APIs-Mavenized/network">script</a> which helps to create local maven repo for Google&#8217;s gdata library.</p>

<p>I used modified version of this script to create my own repository hosted on my server. I&#8217;ll happy if it will be helpfull for someone.</p>

<p>Details under the cut</p>

<!--more-->


<p>How to use:<br/>
First connect the repository to your <code>pom.xml</code>, such as in the example below:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;repositories&gt;</span>
</span><span class='line'>  <span class="nt">&lt;repository&gt;</span>
</span><span class='line'>      <span class="nt">&lt;id&gt;</span>burtsev-net-maven<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>      <span class="nt">&lt;name&gt;</span>Burtsev.Net Maven Repository<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url&gt;</span>http://maven.burtsev.net<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/repository&gt;</span>
</span><span class='line'><span class="nt">&lt;/repositories&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Also you can use mirror on github:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;repositories&gt;</span>
</span><span class='line'>  <span class="nt">&lt;repository&gt;</span>
</span><span class='line'>      <span class="nt">&lt;id&gt;</span>gdata-maven-github<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>      <span class="nt">&lt;name&gt;</span>Google Gdata Maven Repository<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url&gt;</span>https://raw.github.com/eburtsev/gdata-maven/master/<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/repository&gt;</span>
</span><span class='line'><span class="nt">&lt;/repositories&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
And secondly use the dependencies. For example using of Calendar API v2.0:</p>

<figure class='code'><figcaption><span>pom.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>  <span class="nt">&lt;groupId&gt;</span>com.google.gdata.gdata-java-client<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>  <span class="nt">&lt;artifactId&gt;</span>gdata-calendar-2.0<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>  <span class="nt">&lt;version&gt;</span>1.46.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
That&#8217;s it:) I hope it is useful to someone:)</p>

<p>P.S. Modified script you can get <a href="https://github.com/eburtsev/Google-Data-APIs-Mavenized">here</a></p>

<p><strong>Upd. 2012-04-24:</strong> Repository has been updated, added gdata libraries v1.47.0<br/>
<strong>Upd. 2012-08-14:</strong> Repository has been updated, added gdata libraries v1.47.1<br/>
<strong>Upd. 2012-12-23:</strong> Added sources and javadocs jars</p>
]]></content>
  </entry>
  
  
  
  
  
  <entry>
    <title type="html"><![CDATA[Java 7 try-with-resources and MyBatis]]></title>
    <link href="http://burtsev.net/en/2012/01/13/107/"/>
    <updated>2012-01-13T10:41:00+04:00</updated>
    <id>http://burtsev.net/en/2012/01/13/107</id>
    <content type="html"><![CDATA[<p>With Java 7 came analog of using construction from C# - <a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a>. This feature is very well for automatically close resources such as database connections, etc.
For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">try</span> <span class="o">(</span><span class="n">SqlSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="o">.</span><span class="na">getSqlSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// Work with session</span>
</span><span class='line'>  <span class="n">session</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But there are an trouble - class org.apache.ibatis.session.SqlSession from MyBatis 3.0.6 does not implement AutoCloseable interface which is required to work try-with-resources construction. I hope that in next version it will be fixed, but now I can offer small workaround.</p>

<!--more-->


<p>The first implement a wrapper for SqlSession class implements the interface AutoCloseable:</p>

<figure class='code'><figcaption><span>SqlSession.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">burtsev</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">mybatis</span><span class="o">.</span><span class="na">session</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.Closeable</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.executor.BatchResult</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.Configuration</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.ResultHandler</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.RowBounds</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;rawtypes&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SqlSession</span> <span class="kd">implements</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ibatis</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">SqlSession</span><span class="o">,</span> <span class="n">Closeable</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ibatis</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">SqlSession</span> <span class="n">wrappedSession</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">SqlSession</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ibatis</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">SqlSession</span> <span class="n">wrappedSession</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">wrappedSession</span> <span class="o">=</span> <span class="n">wrappedSession</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">selectOne</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectOne</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">selectOne</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectOne</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">List</span> <span class="nf">selectList</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">List</span> <span class="nf">selectList</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">List</span> <span class="nf">selectList</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">RowBounds</span> <span class="n">rowBounds</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">rowBounds</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Map</span> <span class="nf">selectMap</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">String</span> <span class="n">mapKey</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectMap</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">mapKey</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Map</span> <span class="nf">selectMap</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">String</span> <span class="n">mapKey</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectMap</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">mapKey</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Map</span> <span class="nf">selectMap</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">String</span> <span class="n">mapKey</span><span class="o">,</span> <span class="n">RowBounds</span> <span class="n">rowBounds</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">selectMap</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">mapKey</span><span class="o">,</span> <span class="n">rowBounds</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">select</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">ResultHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">select</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">ResultHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">select</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">RowBounds</span> <span class="n">rowBounds</span><span class="o">,</span> <span class="n">ResultHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">rowBounds</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commit</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commit</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">force</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rollback</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rollback</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">rollback</span><span class="o">(</span><span class="n">force</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">BatchResult</span><span class="o">&gt;</span> <span class="n">flushStatements</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">flushStatements</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearCache</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">wrappedSession</span><span class="o">.</span><span class="na">clearCache</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Configuration</span> <span class="nf">getConfiguration</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">getMapper</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Connection</span> <span class="nf">getConnection</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedSession</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also we need write wrapper for SqlSessionFactory class which can work with our custom SqlSession:</p>

<figure class='code'><figcaption><span>SqlSessionFactory.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">burtsev</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">mybatis</span><span class="o">.</span><span class="na">session</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.Configuration</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.ExecutorType</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.TransactionIsolationLevel</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SqlSessionFactory</span> <span class="kd">implements</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ibatis</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">SqlSessionFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ibatis</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">SqlSessionFactory</span> <span class="n">wrappedFactory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">SqlSessionFactory</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">ibatis</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">SqlSessionFactory</span> <span class="n">wrappedFactory</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">wrappedFactory</span> <span class="o">=</span> <span class="n">wrappedFactory</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">autoCommit</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">autoCommit</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="n">Connection</span> <span class="n">connection</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">connection</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="n">TransactionIsolationLevel</span> <span class="n">level</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">level</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="n">ExecutorType</span> <span class="n">execType</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">execType</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="n">ExecutorType</span> <span class="n">execType</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">autoCommit</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">execType</span><span class="o">,</span> <span class="n">autoCommit</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="n">ExecutorType</span> <span class="n">execType</span><span class="o">,</span> <span class="n">TransactionIsolationLevel</span> <span class="n">level</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">execType</span><span class="o">,</span> <span class="n">level</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">SqlSession</span> <span class="nf">openSession</span><span class="o">(</span><span class="n">ExecutorType</span> <span class="n">execType</span><span class="o">,</span> <span class="n">Connection</span> <span class="n">connection</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSession</span><span class="o">(</span><span class="n">wrappedFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="n">execType</span><span class="o">,</span> <span class="n">connection</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Configuration</span> <span class="nf">getConfiguration</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">wrappedFactory</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below I provide iBatis initialization code. It looks as usual, except the line 18, where we initialize our wrapper.</p>

<figure class='code'><figcaption><span>ConnectionFactory.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">burtsev</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">mybatis</span><span class="o">.</span><span class="na">session</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.Reader</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.io.Resources</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSessionFactoryBuilder</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ConnectionFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="n">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Reader</span> <span class="n">reader</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">reader</span> <span class="o">=</span> <span class="n">Resources</span><span class="o">.</span><span class="na">getResourceAsReader</span><span class="o">(</span><span class="s">&quot;mybatis-config.xml&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span> <span class="o">(</span><span class="n">sqlSessionFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SqlSessionFactory</span><span class="o">(</span><span class="k">new</span> <span class="n">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">reader</span><span class="o">,</span> <span class="n">Settings</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()));</span>
</span><span class='line'>              <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">addMappers</span><span class="o">(</span><span class="s">&quot;net.burtsev.example.dao.mybatis.mappers&quot;</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="nf">ConnectionFactory</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">SqlSessionFactory</span> <span class="nf">getSqlSessionFactory</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s all - now we can now enjoy java7 features in our project:)</p>
]]></content>
  </entry>
  
  
  
  <entry>
    <title type="html"><![CDATA[Prevent iBatis org.apache.ibatis.transaction. TransactionException if the database connection is temporarily lost]]></title>
    <link href="http://burtsev.net/en/2012/01/12/100/"/>
    <updated>2012-01-12T14:10:00+04:00</updated>
    <id>http://burtsev.net/en/2012/01/12/100</id>
    <content type="html"><![CDATA[<p>Sometimes there is an unpleasant situation when the database server goes to reboot.
In this case, we can catch a nasty exception like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Caused by: org.apache.ibatis.exceptions.PersistenceException:
</span><span class='line'>### Error opening session.  Cause: org.apache.ibatis.transaction.TransactionException: Error configuring AutoCommit.  Your driver may not support getAutoCommit() or setAutoCommit(). Requested setting: false.  Cause: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: The last packet successfully received from the server was 59,121,876 milliseconds ago.  The last packet sent successfully to the server was 59,121,984 milliseconds ago. is longer than the server configured value of &#39;wait_timeout&#39;. You should consider either expiring and/or testing connection validity before use in your application, increasing the server configured values for client timeouts, or using the Connector/J connection property &#39;autoReconnect=true&#39; to avoid this problem.
</span><span class='line'>### Cause: org.apache.ibatis.transaction.TransactionException: Error configuring AutoCommit.  Your driver may not support getAutoCommit() or setAutoCommit(). Requested setting: false.  Cause: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: The last packet successfully received from the server was 59,121,876 milliseconds ago.  The last packet sent successfully to the server was 59,121,984 milliseconds ago. is longer than the server configured value of &#39;wait_timeout&#39;. You should consider either expiring and/or testing connection validity before use in your application, increasing the server configured values for client timeouts, or using the Connector/J connection property &#39;autoReconnect=true&#39; to avoid this problem.
</span><span class='line'>        at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:8)
</span><span class='line'>        at org.apache.ibatis.session.defaults.DefaultSqlSessionFactory.openSessionFromDataSource(DefaultSqlSessionFactory.java:83)
</span><span class='line'>        at org.apache.ibatis.session.defaults.DefaultSqlSessionFactory.openSession(DefaultSqlSessionFactory.java:32)
</span><span class='line'>        at com.greytower.htmltemplates.core.dao.ibatis.TemplatesDAOImpl.readAll(TemplatesDAOImpl.java:70)
</span><span class='line'>        at com.greytower.htmltemplates.beans.TemplatesEditorBean.init(TemplatesEditorBean.java:86)
</span><span class='line'>        ... 59 more
</span><span class='line'>Caused by: org.apache.ibatis.transaction.TransactionException: Error configuring AutoCommit.  Your driver may not support getAutoCommit() or setAutoCommit(). Requested setting: false.  Cause: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: The last packet successfully received from the server was 59,121,876 milliseconds ago.  The last packet sent successfully to the server was 59,121,984 milliseconds ago. is longer than the server configured value of &#39;wait_timeout&#39;. You should consider either expiring and/or testing connection validity before use in your application, increasing the server configured values for client timeouts, or using the Connector/J connection property &#39;autoReconnect=true&#39; to avoid this problem.
</span><span class='line'>        at org.apache.ibatis.transaction.jdbc.JdbcTransaction.setDesiredAutoCommit(JdbcTransaction.java:51)
</span><span class='line'>        at org.apache.ibatis.transaction.jdbc.JdbcTransaction.&lt;init&gt;(JdbcTransaction.java:19)
</span><span class='line'>        at org.apache.ibatis.transaction.jdbc.JdbcTransactionFactory.newTransaction(JdbcTransactionFactory.java:15)
</span><span class='line'>        at org.apache.ibatis.session.defaults.DefaultSqlSessionFactory.openSessionFromDataSource(DefaultSqlSessionFactory.java:78)
</span><span class='line'>        ... 62 more
</span><span class='line'>Caused by: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: The last packet successfully received from the server was 59,121,876 milliseconds ago.  The last packet sent successfully to the server was 59,121,984 milliseconds ago. is longer than the server configured value of &#39;wait_timeout&#39;. You should consider either expiring and/or testing connection validity before use in your application, increasing the server configured values for client timeouts, or using the Connector/J connection property &#39;autoReconnect=true&#39; to avoid this problem.
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>To solve this problem you need to set the poolPingQuery and poolPingEnabled properties in the iBatis config file. For example, see lines 17 and 18 in code below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;typeAliases&gt;</span>
</span><span class='line'>      ...
</span><span class='line'>  <span class="nt">&lt;/typeAliases&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;environments</span> <span class="na">default=</span><span class="s">&quot;development&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;environment</span> <span class="na">id=</span><span class="s">&quot;development&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;transactionManager</span> <span class="na">type=</span><span class="s">&quot;JDBC&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;dataSource</span> <span class="na">type=</span><span class="s">&quot;POOLED&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driver&quot;</span> <span class="na">value=</span><span class="s">&quot;${db.driver}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;${db.url}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${db.user}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${db.password}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;poolPingQuery&quot;</span> <span class="na">value=</span><span class="s">&quot;SELECT id FROM user WHERE id = 1&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;poolPingEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/dataSource&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/environment&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/environments&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  
  
  
  
  <entry>
    <title type="html"><![CDATA[PrimeFaces tips & tricks]]></title>
    <link href="http://burtsev.net/en/2011/10/02/63/"/>
    <updated>2011-10-02T13:00:00+04:00</updated>
    <id>http://burtsev.net/en/2011/10/02/63</id>
    <content type="html"><![CDATA[<p>Below I will describe solutions to common problems occurring working with <a href="http://primefaces.org">PrimeFaces</a> JSF components library.</p>

<!--more-->


<h2>Components size</h2>

<p>Probably everyone who started to use the library asked the question &#8220;Why components look so huge?&#8221;.
To solve this problem, just add following CSS code inside <code>&lt;h:head&gt;&lt;/h:head&gt;</code> tag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.ui-widget</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">75</span><span class="o">%</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.ui-widget</span> <span class="nc">.ui-widget</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">100</span><span class="o">%</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>PrimeFaces vs Internet Explorer</h2>

<p>Internet Explorer may incorrectly render pages in which you using PrimeFaces components. To solve this problem is recommended to set the X-UA-Compatible header. In old versions of this library (&lt; 3.0) you can make this by adding meta tag in <code>&lt;h:head&gt;&lt;/h:head&gt;</code> tag first. But in newest versions library first renders own code in head tag, and next user code. For solve this in version 3.0 introduced the &#8220;first&#8221; facet, which renders exactly first in head tag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;h:head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;f:facet</span> <span class="na">name=</span><span class="s">&quot;first&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;EmulateIE8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/xhtml; charset=UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Cache-Control&quot;</span> <span class="na">content=</span><span class="s">&quot;no-cache&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Pragma&quot;</span> <span class="na">content=</span><span class="s">&quot;no-cache&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;title&gt;&lt;ui:insert</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Application Title<span class="nt">&lt;/ui:insert&gt;&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/f:facet&gt;</span>
</span><span class='line'><span class="nt">&lt;/h:head&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Vertical tabs in p:tabView</h2>

<p>Because this library based on jQueryUI, for create vertical tabs we can use <a href="http://jquery-ui.googlecode.com/svn/trunk/demos/tabs/vertical.html">this demo</a> as solution. First add following CSS:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* Vertical Tabs</span>
</span><span class='line'><span class="c">----------------------------------*/</span>
</span><span class='line'><span class="nc">.ui-tabs-vertical</span> <span class="p">{</span> <span class="k">width</span><span class="o">:</span> <span class="m">55em</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="nc">.ui-tabs-vertical</span> <span class="nc">.ui-tabs-nav</span> <span class="p">{</span> <span class="k">padding</span><span class="o">:</span> <span class="m">.2em</span> <span class="m">.1em</span> <span class="m">.2em</span> <span class="m">.2em</span><span class="p">;</span> <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span> <span class="k">width</span><span class="o">:</span> <span class="m">12em</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="nc">.ui-tabs-vertical</span> <span class="nc">.ui-tabs-nav</span> <span class="nt">li</span> <span class="p">{</span> <span class="k">clear</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span> <span class="k">width</span><span class="o">:</span> <span class="m">100</span><span class="o">%</span><span class="p">;</span> <span class="k">border-bottom-width</span><span class="o">:</span> <span class="m">1px</span> <span class="cp">!important</span><span class="p">;</span> <span class="k">border-right</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">0</span> <span class="cp">!important</span><span class="p">;</span> <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="m">-1px</span> <span class="m">.2em</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="nc">.ui-tabs-vertical</span> <span class="nc">.ui-tabs-nav</span> <span class="nt">li</span> <span class="nt">a</span> <span class="p">{</span> <span class="k">display</span><span class="o">:</span><span class="k">block</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="nc">.ui-tabs-vertical</span> <span class="nc">.ui-tabs-nav</span> <span class="nt">li</span><span class="nc">.ui-tabs-selected</span> <span class="p">{</span> <span class="k">padding-bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span> <span class="k">padding-right</span><span class="o">:</span> <span class="m">.1em</span><span class="p">;</span> <span class="k">border-right</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">1px</span><span class="p">;</span> <span class="k">border-right</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">1px</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="nc">.ui-tabs-vertical</span> <span class="nc">.ui-tabs-panel</span> <span class="p">{</span> <span class="k">padding</span><span class="o">:</span> <span class="m">1em</span><span class="p">;</span> <span class="k">float</span><span class="o">:</span> <span class="k">right</span><span class="p">;</span> <span class="k">width</span><span class="o">:</span> <span class="m">40em</span><span class="p">;}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And add styleClass property to your tabView:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;p:tabView</span> <span class="na">styleClass=</span><span class="s">&quot;ui-tabs-vertical&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s it ;)
This solution based on following questions on <a href="http://stackowerflow.com">StackOverflow</a>:
*   <a href="http://stackoverflow.com/q/6098319/600313">Make tabs appear vertically on the side when using PrimeFaces TabView</a>
*   <a href="http://stackoverflow.com/q/773074/600313">Vertical Tabs with JQuery?</a></p>
]]></content>
  </entry>
  
  
  
  
  
  
  
  <entry>
    <title type="html"><![CDATA[Installation of Mercurial + UWSGI + Nginx + HTTPS on Ubuntu Server 10.04]]></title>
    <link href="http://burtsev.net/en/2011/08/03/13/"/>
    <updated>2011-08-03T20:28:00+04:00</updated>
    <id>http://burtsev.net/en/2011/08/03/13</id>
    <content type="html"><![CDATA[<p>Some times ago I installed Mercurial server, using as a frontend nginx. Internet has a lot of information about this, but I had to improvise a lot that would achieve a result. So, here is the result of my work.</p>

<!--more-->


<p>All commands in this guide you need to run with root rights. Let&#8217;s go :)</p>

<h2>Install required software</h2>

<h3>Python</h3>

<p>Install Python first time.</p>

<pre><code>apt-get install python
</code></pre>

<p>Install python-software-properties - this is best way for adding PPA :)</p>

<pre><code>apt-get install python-software-properties
</code></pre>

<p>After installing it you can add PPA by following command. It&#8217;s really simple.</p>

<pre><code>add-apt-repository ppa:xxx/yyy
</code></pre>

<h3>Mercurial</h3>

<p>In Lucid Lynx repository mercurial present, but it&#8217;s version is too old, so install third-party PPA with newest versions of mercurial:</p>

<pre><code>add-apt-repository ppa:mercurial-ppa/stable-snapshots
apt-get update
apt-get install mercurial
</code></pre>

<h3>Nginx</h3>

<p>Install nginx from third-party PPA.</p>

<pre><code>add-apt-repository ppa:nginx/stable
apt-get update
apt-get install nginx
</code></pre>

<h3>uwsgi-python</h3>

<p>Install uwsgi-python as python application server.</p>

<pre><code>add-apt-repository ppa:uwsgi/release
apt-get update
apt-get install uwsgi-python
</code></pre>

<h2>Configuration</h2>

<p>After software installation go to the next step - configuration.
First, review directories structure used in this guide.</p>

<pre><code>/var/www/hosts/hg.server.net/conf       
/var/www/hosts/hg.server.net/logs      
/var/www/hosts/hg.server.net/repos   ,  
</code></pre>

<h3>Mercurial + uwsgi</h3>

<p>Create UWSGI-application <code>/etc/uwsgi-python/apps-available/hgweb.xml</code>:</p>

<figure class='code'><figcaption><span>hgweb.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;uwsgi&gt;</span>
</span><span class='line'>  <span class="nt">&lt;socket&gt;</span>/var/run/uwsgi.hgweb.sock<span class="nt">&lt;/socket&gt;</span>
</span><span class='line'>  <span class="nt">&lt;master/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;workers&gt;</span>2<span class="nt">&lt;/workers&gt;</span>
</span><span class='line'>  <span class="cp">&lt;![CDATA[</span>
</span><span class='line'><span class="cp">     import uwsgi</span>
</span><span class='line'><span class="cp">     import os</span>
</span><span class='line'>
</span><span class='line'><span class="cp">     os.environ[&quot;HGENCODING&quot;] = &quot;UTF-8&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">     from mercurial import demandimport; demandimport.enable()</span>
</span><span class='line'><span class="cp">     from mercurial.hgweb.hgwebdir_mod import hgwebdir</span>
</span><span class='line'>
</span><span class='line'><span class="cp">     application = hgwebdir(&#39;/var/www/hosts/hg.server.net/conf/hgweb.config&#39;)</span>
</span><span class='line'><span class="cp"> ]]&gt;</span>
</span><span class='line'><span class="nt">&lt;/uwsgi&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that in 14-th line you need change path to hgweb config, which we create now.</p>

<p>Create file <code>/var/www/hosts/hg.server.net/conf/hgweb.config</code>:</p>

<figure class='code'><figcaption><span>hgweb.config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[web]</span>
</span><span class='line'><span class="na">push_ssl</span> <span class="o">=</span> <span class="s">true</span>
</span><span class='line'><span class="na">allow_push</span> <span class="o">=</span> <span class="s">*</span>
</span><span class='line'><span class="na">style</span> <span class="o">=</span> <span class="s">gitweb</span>
</span><span class='line'><span class="na">allow_archive</span> <span class="o">=</span> <span class="s">gz, zip, bz2</span>
</span><span class='line'>
</span><span class='line'><span class="k">[collections]</span>
</span><span class='line'><span class="na">/var/www/hosts/hg.server.net/repos/</span> <span class="o">=</span> <span class="s">/var/www/hosts/hg.server.net/repos/</span>
</span></code></pre></td></tr></table></div></figure>


<p>In last line you need change patchs to repositories dir.
Now we can check how works uwsgi server. For test change line <code>&lt;socket&gt;/var/run/uwsgi.hgweb.sock&lt;/socket&gt;</code> in hgweb.xml file to <code>&lt;socket&gt;127.0.0.1:3031&lt;/socket&gt;</code> and run:</p>

<pre><code>uwsgi-python -x /etc/uwsgi-python/apps-available/hgweb.xml
</code></pre>

<p>If all is OK you can go to <code>http://127.0.0.1:3031/</code> and see repositories list. If it&#8217;s true, revert hgweb.xml and make symlink to <code>/etc/uwsgi-python/apps-enabled</code>:</p>

<pre><code>ln -s /etc/uwsgi-python/apps-{available,enabled}/hgweb.xml
</code></pre>

<p>Now we can go to next step.</p>

<h3>Nginx</h3>

<p>Create auth file with htpasswd utility</p>

<pre><code>htpasswd -c /var/www/auth/.htpasswd &lt;username&gt;
</code></pre>

<p>Create nginx config /etc/nginx/sites-available/hg.server.net</p>

<figure class='code'><figcaption><span>hg.server.net</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='nginx'><span class='line'><span class="k">server</span> <span class="p">{</span>
</span><span class='line'>  <span class="kn">listen</span>               <span class="mi">443</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">listen</span>               <span class="mi">80</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">server_name</span>          <span class="s">hg.server.net</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">ssl</span>                  <span class="no">on</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">ssl_protocols</span>        <span class="s">SSLv3</span> <span class="s">TLSv1</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">ssl_certificate</span>      <span class="s">/var/www/hosts/hg.server.net/ssl/ssl_certificate.crt</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">ssl_certificate_key</span>  <span class="s">/var/www/hosts/hg.server.net/ssl/ssl_certificate.key</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">root</span>                 <span class="s">/var/www/hosts/hg.server.net/www</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">access_log</span>           <span class="s">/var/www/hosts/hg.server.net/logs/access.log</span><span class="p">;</span>
</span><span class='line'>  <span class="kn">error_log</span>            <span class="s">/var/www/hosts/hg.server.net/logs/error.log</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Need for very big files</span>
</span><span class='line'>  <span class="kn">client_max_body_size</span> <span class="mi">100m</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">if</span> <span class="s">(</span> <span class="nv">$scheme</span> <span class="p">=</span> <span class="s">&quot;http&quot;</span> <span class="s">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kn">rewrite</span> <span class="s">^/(.*)</span>$  <span class="s">https://</span><span class="nv">$host/$1</span> <span class="s">permanent</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span><span class='line'>      <span class="kn">auth_basic</span>                  <span class="s">&quot;Mercurial</span> <span class="s">Repository&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">auth_basic_user_file</span>        <span class="s">/var/www/auth/.htpasswd</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">include</span>     <span class="s">uwsgi_params</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">REMOTE_PORT</span>     <span class="nv">$remote_port</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">SERVER_PORT</span>     <span class="nv">$server_port</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">SERVER_PROTOCOL</span> <span class="nv">$server_protocol</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">UWSGI_SCHEME</span>    <span class="nv">$scheme</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">SCRIPT_NAME</span>     <span class="s">/</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">AUTH_USER</span>       <span class="nv">$remote_user</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_param</span> <span class="s">REMOTE_USER</span>     <span class="nv">$remote_user</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">uwsgi_pass</span>  <span class="s">hgweb</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">location</span> <span class="s">/static/</span> <span class="p">{</span>
</span><span class='line'>      <span class="kn">rewrite</span>       <span class="s">/static/(.*)</span>  <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">root</span>          <span class="s">/usr/share/mercurial/templates/static</span><span class="p">;</span>
</span><span class='line'>      <span class="kn">expires</span> <span class="s">30d</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">location</span> <span class="p">~</span> <span class="sr">/\.</span> <span class="p">{</span>
</span><span class='line'>      <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">upstream</span> <span class="s">hgweb</span> <span class="p">{</span>
</span><span class='line'>  <span class="kn">server</span> <span class="s">unix:/var/run/uwsgi.hgweb.sock</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make symlink for config in <code>/etc/nginx/sites-enabled</code> directory:</p>

<pre><code>ln -s /etc/nginx/sites-{available,enabled}/hg.server.net
</code></pre>

<p>Start services:</p>

<pre><code>service uwsgi-python start
service nginx start
</code></pre>

<p>Try open <code>http://hg.server.net/</code> in browser. All is OK if you see list of repositories. If you get an error - check settings.
Next we can add all services to autorun.</p>

<h3>Auto start services at boot</h3>

<p>First, make symlinks to configs as I write in examples below.
Then configure required services for auto start at boot:</p>

<pre><code>update-rc.d uwsgi-python defaults
update-rc.d nginx defaults
</code></pre>

<p>That&#8217;s it. You can reboot and check how it works.</p>
]]></content>
  </entry>
  
  
</feed>

